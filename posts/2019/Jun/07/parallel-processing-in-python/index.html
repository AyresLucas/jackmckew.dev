
<!DOCTYPE html>
<html lang="english">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://jmckew.com/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://jmckew.com/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://jmckew.com/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://jmckew.com/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://jmckew.com/theme/font-awesome/css/solid.css">


    <link href="https://jmckew.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jack McKew's Blog Atom">


    <link rel="shortcut icon" href="content/img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="content/img/favicon.ico" type="image/x-icon">



<meta name="author" content="Jack McKew" />
<meta name="description" content="Parallel processing is a mode of operation where the task is executed simultaneously in multiple processors in the same computer. The purpose of this is intended to reduce the overall processing time, however, there is often overhead between communicating processes. For small tasks, the overhead is detrimental to the length …" />
<meta name="keywords" content="python">


<meta property="og:site_name" content="Jack McKew's Blog"/>
<meta property="og:title" content="Parallel Processing in Python"/>
<meta property="og:description" content="Parallel processing is a mode of operation where the task is executed simultaneously in multiple processors in the same computer. The purpose of this is intended to reduce the overall processing time, however, there is often overhead between communicating processes. For small tasks, the overhead is detrimental to the length …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://jmckew.com/posts/parallel-processing-in-python/"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-06-07 06:30:00+10:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://jmckew.com/author/jack-mckew.html">
<meta property="article:section" content="misc"/>
<meta property="article:tag" content="python"/>
<meta property="og:image" content="img/jm-photo.jpg">

  <title>Jack McKew's Blog &ndash; Parallel Processing in Python</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://jmckew.com">
        <img src="img/jm-photo.jpg" alt="" title="">
      </a>
      <h1><a href="https://jmckew.com"></a></h1>

<p>Python enthusiast, electrical engineer and tinkerer</p>
      <nav>
        <ul class="list">

            <li><a target="_blank" href="https://jmckew.com/pages/contact.html#contact">Contact</a></li>
            <li><a target="_blank" href="https://jmckew.com/pages/cv-professional.html#cv-professional">CV/Professional</a></li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-twitter" href="https://twitter.com/Jac_McQ" target="_blank">
            <i class="fab fa-twitter">
            </i>
          </a></li>
          <li>
            <a  class="sc-linkedin" href="https://www.linkedin.com/in/jack-mckew/" target="_blank">
            <i class="fab fa-linkedin">
            </i>
          </a></li>
          <li>
            <a  class="sc-github" href="https://github.com/JackMcKew" target="_blank">
            <i class="fab fa-github">
            </i>
          </a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://jmckew.com">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/tags.html">Tags</a>
      <a href="/sitemap.xml">Sitemap</a>

      <a href="https://jmckew.com/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="parallel-processing-in-python">Parallel Processing in Python</h1>
    <p>
          Posted on Fri 07 June 2019 in <a href="https://jmckew.com/category/misc.html">misc</a>


        &#8226; 3 min read
    </p>
  </header>


  <div>
    <body><p>Parallel processing is a mode of operation where the task is executed simultaneously in multiple processors in the same computer. The purpose of this is intended to reduce the overall processing time, however, there is often overhead between communicating processes. For small tasks, the overhead is detrimental to the length of processing, increasing the overall time taken.</p>
<p>For this post we will be using the multiprocessing package in Python. Multiprocessing is apart of the standard library within Python and is a package that supports spawning processes using an API similar to the threading module (also apart of the standard library). The main benefit of the multiprocessing package, is that it disregards the global interpreter lock (GIL), by using sub processes instead of threads.</p>
<p>The number of processors or threads in your computer dictates the maximum number of processes you can run at a time. To add flexibility to your program when it may be run across multiple machines, it is good practice to make use of the cpu_count() function apart of the multiprocessing, as shown below (please note f strings were only introduced in Python 3.6).</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="kn">as</span> <span class="nn">mp</span></span>
<span class="code-line"><span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">"Maximum number of processes: {mp.cpu_count()}"</span><span class="p">)</span></span>
</pre></div>
<p>In parallel processing, there are two types of execution: Synchronous and Asynchronous. Synchronous meaning where the processes are completed in the same order in which it was started, such that, the output is (normally) in order. While asynchronous means the processes can be in any order, and while the output can be mixed, is usually computed faster.</p>
<p>Within multiprocessing there are 2 main classes that you will use for parallel processing: Pool &amp; Process. The two classes are intended to be used in completely different scenarios, but still utilize parallel processing. Pool is beneficial for when you have a long list that need to be processed and combined back together at the end. Process is beneficial for when you need multiple functions running simultaneously, albeit not the same.</p>
<h3>The Pool Class</h3>
<p>The pool class has four methods that are particular useful:</p>
<ul>
<li>Pool.apply</li>
<li>Pool.map</li>
<li>Pool.apply_async</li>
<li>Pool.map_async</li>
</ul>
<p>Before we tackle the asynchronous variants of the pool methods (async suffix). Here is a simple example using Pool.apply and Pool.map. We initialize the number of processes to however many is available or the maximum of the system.</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">power_n_minus_1</span><span class="p">(</span><span class="n">value</span><span class="p">):</span></span>
<span class="code-line">    <span class="k">return</span> <span class="n">value</span><span class="o">**</span><span class="n">value</span><span class="o">-</span><span class="mi">1</span></span>
<span class="code-line"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">pool</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span></span>
<span class="code-line">    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">pool</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">power_n_minus_1</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)]</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span></span>
</pre></div>
<p>With the results being: [1, 2, 9, 64] or 1\^0, 2\^1,3\^2,4\^3. This can also be achieved similarly with Pool.map.</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">power_n_minus_1</span><span class="p">(</span><span class="n">value</span><span class="p">):</span></span>
<span class="code-line">    <span class="k">return</span> <span class="n">value</span><span class="o">**</span><span class="n">value</span><span class="o">-</span><span class="mi">1</span></span>
<span class="code-line"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">pool</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span></span>
<span class="code-line">    <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">power_n_minus_1</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span></span>
</pre></div>
<p>Both of these will lock the main program that is calling them until all processes in the pool are finished, use this if you want to obtain results in a particular order. However if you don't care about the order and want to retrieve results as soon as they finished, then use the async variant.</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">power_n_minus_1</span><span class="p">(</span><span class="n">value</span><span class="p">):</span></span>
<span class="code-line">    <span class="k">return</span> <span class="n">value</span><span class="o">**</span><span class="n">value</span><span class="o">-</span><span class="mi">1</span></span>
<span class="code-line"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">pool</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span></span>
<span class="code-line">    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">power_n_minus_1</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)]</span></span>
<span class="code-line">    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">]</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span></span>
</pre></div>
<h3>The Process Class</h3>
<p>The process class is the most basic approach to parallel processing from multiprocessing package. Here we will use a simple queue function to generate 10 random numbers in parallel.</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="kn">as</span> <span class="nn">mp</span></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">random</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">output</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">rand_number</span><span class="p">(</span><span class="n">lower_limit</span><span class="p">,</span><span class="n">upper_limit</span><span class="p">,</span><span class="n">output</span><span class="p">):</span></span>
<span class="code-line">    <span class="n">output</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">lower_limit</span><span class="p">,</span><span class="n">upper_limit</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">processes</span> <span class="o">=</span> <span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">rand_number</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="n">output</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span></span>
<span class="code-line">    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span></span>
<span class="code-line">        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></span>
<span class="code-line">    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span></span>
<span class="code-line">        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span></span>
<span class="code-line">    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">]</span></span>
<span class="code-line">    <span class="k">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span></span>
</pre></div>
<p>With the result being: [76, 40, 76, 27, 64, 94, 30, 71, 70, 40].</p>
<p>By utilizing the multiprocessing package in Python or parallel computing concepts in general, you will now be able to dramatically increase computation times (for large processes).</p></body>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://jmckew.com/tag/python.html">python</a>
    </p>
  </div>





</article>

    <footer>
<p>&copy;  </p>
<p>    Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Jack McKew's Blog ",
  "url" : "https://jmckew.com",
  "image": "img/jm-photo.jpg",
  "description": ""
}
</script>

</body>
</html>