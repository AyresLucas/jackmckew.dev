<!DOCTYPE html>
<html lang="english">
<head>
          <title>Jack McKew's Blog - Intro to Games in Python with Pyglet</title>
        <meta charset="utf-8" />




    <meta name="tags" content="python" />
    <meta name="tags" content="pyglet" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://jackmckew.dev/">Jack McKew's Blog <strong>Python enthusiast, electrical engineer and tinkerer</strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="/archives.html">Archives</a></li>
            <li><a href="/categories.html">Categories</a></li>
            <li><a href="/tags.html">Tags</a></li>
            <li><a href="/sitemap.xml">Sitemap</a></li>
            <li><a href="https://jackmckew.dev/pages/contact.html">Contact</a></li>
            <li><a href="https://jackmckew.dev/pages/cv-professional.html">CV/Professional</a></li>
            <li><a href="https://jackmckew.dev/category/android.html">Android</a></li>
            <li><a href="https://jackmckew.dev/category/book-reviews.html">Book Reviews</a></li>
            <li><a href="https://jackmckew.dev/category/data-science.html">Data Science</a></li>
            <li><a href="https://jackmckew.dev/category/engineering.html">Engineering</a></li>
            <li><a href="https://jackmckew.dev/category/engineering-python.html">Engineering, Python</a></li>
            <li><a href="https://jackmckew.dev/category/machine-learning.html">Machine Learning</a></li>
            <li><a href="https://jackmckew.dev/category/principles.html">Principles</a></li>
            <li class="active"><a href="https://jackmckew.dev/category/python.html">Python</a></li>
            <li><a href="https://jackmckew.dev/category/python-data-science.html">Python, Data Science</a></li>
            <li><a href="https://jackmckew.dev/category/python-engineering.html">Python, Engineering</a></li>
            <li><a href="https://jackmckew.dev/category/python-principles.html">Python, Principles</a></li>
            <li><a href="https://jackmckew.dev/category/software-development.html">Software Development</a></li>
            <li><a href="https://jackmckew.dev/category/software-development-data-science.html">Software Development, Data Science</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="https://jackmckew.dev/intro-to-games-in-python-with-pyglet.html" rel="bookmark"
         title="Permalink to Intro to Games in Python with Pyglet">Intro to Games in Python with Pyglet</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2019-10-04T06:30:00+10:00">
      Fri 04 October 2019
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="https://jackmckew.dev/author/jack-mckew.html">Jack McKew</a>
    </address>
    <div class="category">
        Category: <a href="https://jackmckew.dev/category/python.html">Python</a>
    </div>
    <div class="tags">
        Tags:
            <a href="https://jackmckew.dev/tag/python.html">python</a>
            <a href="https://jackmckew.dev/tag/pyglet.html">pyglet</a>
    </div>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Recently, I've been researching ways that I could run a 2D simulation (and hopefully 3D) with many moving pieces and there was a desire to make it interactive as well. I stumbled through many visualisation frameworks such as:</p>
<ul>
<li><a href="https://pypi.org/project/p5/">p5</a></li>
<li><a href="https://www.pygame.org/news">pygame</a></li>
<li><a href="https://plot.ly/">plotly</a></li>
<li><a href="https://www.panda3d.org/">panda3d</a></li>
<li><a href="https://bokeh.pydata.org/en/latest/">bokeh</a></li>
<li>many others</li>
</ul>
<p>Eventually, through the motivation of another side project (looking into training neural networks to learn how to play games) and inspired by this video from Code Bullet <a href="https://www.youtube.com/watch?v=r428O_CMcpI">https://www.youtube.com/watch?v=r428O_CMcpI</a>; I decided on attempting to use <a href="https://pyglet.readthedocs.io/en/stable/">Pyglet</a> to do these simulations.</p>
<p>While the aforementioned simulations won't be covered in this post, this post aims to demonstrate how I adapted the <a href="https://pyglet.readthedocs.io/en/stable/programming_guide/examplegame.html">in-depth tutorial on the Pyglet website</a> (which goes through how to recreate asteroids in Pyglet) to generate vector based objects which can crash into each other.</p>
<p>First off as always, start by setting up a virtual environment with your preferred method (<a href="https://jmckew.com/2019/01/11/episode-8-anaconda/">Anaconda</a> or <a href="https://jmckew.com/2019/08/30/python-project-workflow/">follow my workflow</a>), since Pyglet has no external dependencies, all you need to do is install the pyglet package.</p>
<p>I won't go through all the code in the example, and how it works, I will only go through what I changed in the case to get where I wanted to go.</p>
<p>To begin, and make things a bit easier, I downloaded the pyglet-master repository from GitHub (<a href="https://github.com/pyglet/pyglet">https://github.com/pyglet/pyglet</a>) so I didn't have to create and copy the file contents one by one.</p>
<p>After going through the different versions with the examples > game folder, I decided all I required was the simple functionality of collision and any further into developing the game wasn't needed for this stage, so I copied out the version 3 folder.</p>
<p>If we run 'asteroid.py' from within the version 3 folder, we are met with this screen</p>
<p><img alt="full_game_screen" src="..\img\intro-to-games-in-python-with-pyglet\image.png"></p>
<p>Now since all I am trying to do is generate multiple objects (which will be shown with the player symbol to indicate direction), I can comment out the lines which give the lives, score, title and interactive player.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Set up the two top labels</span>
<span class="c1"># score_label = pyglet.text.Label(text=&quot;Score: 0&quot;, x=10, y=575, batch=main_batch)</span>
<span class="c1"># level_label = pyglet.text.Label(text=&quot;Version 3: Basic Collision&quot;,</span>
<span class="c1">#                                 x=400, y=575, anchor_x=&#39;center&#39;, batch=main_batch)</span>

<span class="c1"># Initialize the player sprite</span>
<span class="c1"># player_ship = player.Player(x=400, y=300, batch=main_batch)</span>

<span class="c1"># Make three sprites to represent remaining lives</span>
<span class="c1"># player_lives = load.player_lives(2, main_batch)</span>

<span class="c1"># Make three asteroids so we have something to shoot at </span>
<span class="c1"># asteroids = load.asteroids(3, player_ship.position, main_batch)</span>

<span class="n">asteroids</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">asteroids</span><span class="p">(</span><span class="mi">100</span><span class="p">,(</span><span class="n">window_width</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">window_height</span><span class="o">//</span><span class="mi">2</span><span class="p">),</span><span class="n">main_batch</span><span class="p">)</span>

<span class="c1"># Store all objects that update each frame in a list</span>
<span class="c1"># game_objects = [player_ship] + asteroids</span>
<span class="n">game_objects</span> <span class="o">=</span> <span class="n">asteroids</span>

<span class="c1"># Tell the main window that the player object responds to events</span>
<span class="c1"># game_window.push_handlers(player_ship.key_handler)</span>
</pre></div>
</td></tr></table>

<p>Now that we've done that, we need to modify the asteroids generator function to use the player sprite.</p>
<p>In load.py, you can change simply the img argument to the player image sprite reference like so:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">new_asteroid</span> <span class="o">=</span> <span class="n">physicalobject</span><span class="o">.</span><span class="n">PhysicalObject</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">resources</span><span class="o">.</span><span class="n">player_image</span><span class="p">,</span>                                                     <span class="n">x</span><span class="o">=</span><span class="n">asteroid_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">asteroid_y</span><span class="p">,</span>                                                 <span class="n">batch</span><span class="o">=</span><span class="n">batch</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Now if we run this, the animation will look a little off, because the objects won't be traveling the direction in the direction that the sprite is pointing. This is due to the existing velocity calculation being a random number for both the X and Y component.</p>
<p>To make the player sprites move in the direction they are rotated in, and maintain the existing codebase, we will need to convert from <a href="https://www.mathsisfun.com/polar-cartesian-coordinates.html">polar notation to cartesian</a>.</p>
<p>To do this, we add an extra 2 functions into 'util.py' which will do this for us:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cart2pol</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pol2cart</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Note the use of radians in pol2cart, this is due to the <a href="https://www.sparknotes.com/math/trigonometry/trigonometricfunctions/section3/">affect of quadrants and trigonometric functions</a>. I won't go into detail, but it won't behave like you expect it to.</p>
<p>Now to get our player sprites moving in the direction they are rotated, update the code which generates the 'asteroids' to utilise our new function:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">new_asteroid</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
<span class="n">new_asteroid</span><span class="o">.</span><span class="n">velocity_speed</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">40</span>
<span class="n">new_asteroid</span><span class="o">.</span><span class="n">velocity_x</span><span class="p">,</span> <span class="n">new_asteroid</span><span class="o">.</span><span class="n">velocity_y</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">pol2cart</span><span class="p">(</span><span class="n">new_asteroid</span><span class="o">.</span><span class="n">velocity_speed</span><span class="p">,</span><span class="n">new_asteroid</span><span class="o">.</span><span class="n">rotation</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Now when we go and run our main file again, we will met with a screen like this:</p>
<p><img alt="boids_screen" src="..\img\intro-to-games-in-python-with-pyglet\image-1.png"></p>
<p>Where the player sprites will float around in the direction they are pointing, until they crash into another sprite, causing both of them to disappear.</p>
<p>This is a quick intro to Pyglet, I am hoping to expand on this simulation and am positive I will be doing further write ups with it in the future.</p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>