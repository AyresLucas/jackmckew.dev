<!DOCTYPE html>
<html lang="english">
<head>
        <meta charset="utf-8" />
        <title>Intro to Games in Python with Pyglet</title>
        <link rel="stylesheet" href="https://jmckew.com/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://jmckew.com/">Jack McKew's Blog </a></h1>
                <nav><ul>
                    <li class="active"><a href="https://jmckew.com/category/code-fridays.html">Code Fridays</a></li>
                    <li><a href="https://jmckew.com/category/code-fridays-projects.html">Code Fridays, Projects</a></li>
                    <li><a href="https://jmckew.com/category/code-fridays-python.html">Code Fridays, python</a></li>
                    <li><a href="https://jmckew.com/category/code-fridays-uncategorized.html">Code Fridays, Uncategorized</a></li>
                    <li><a href="https://jmckew.com/category/misc.html">misc</a></li>
                    <li><a href="https://jmckew.com/category/python.html">python</a></li>
                    <li><a href="https://jmckew.com/category/uncategorized.html">Uncategorized</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://jmckew.com/intro-to-games-in-python-with-pyglet.html" rel="bookmark"
           title="Permalink to Intro to Games in Python with Pyglet">Intro to Games in Python with Pyglet</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2019-10-04T06:30:00+10:00">
                Published: Fri 04 October 2019
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://jmckew.com/author/admin.html">admin</a>
        </address>
<p>In <a href="https://jmckew.com/category/code-fridays.html">Code Fridays</a>.</p>

</footer><!-- /.post-info -->      <!-- wp:paragraph -->

<p>Recently, I've been researching ways that I could run a 2D simulation (and hopefully 3D) with many moving pieces and there was a desire to make it interactive as well. I stumbled through many visualisation frameworks such as:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->

<ul>
<li><a href="https://pypi.org/project/p5/">p5</a></li>
<li><a href="https://www.pygame.org/news">pygame</a></li>
<li><a href="https://plot.ly/">plotly</a></li>
<li><a href="https://www.panda3d.org/">panda3d</a></li>
<li><a href="https://bokeh.pydata.org/en/latest/">bokeh</a></li>
<li>many others</li>
</ul>
<!-- /wp:list -->

<!-- wp:paragraph -->

<p>Eventually, through the motivation of another side project (looking into training neural networks to learn how to play games) and inspired by this video from Code Bullet <a href="https://www.youtube.com/watch?v=r428O_CMcpI">https://www.youtube.com/watch?v=r428O_CMcpI</a>; I decided on attempting to use <a href="https://pyglet.readthedocs.io/en/stable/">Pyglet</a> to do these simulations.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<p>While the aforementioned simulations won't be covered in this post, this post aims to demonstrate how I adapted the <a href="https://pyglet.readthedocs.io/en/stable/programming_guide/examplegame.html">in-depth tutorial on the Pyglet website</a> (which goes through how to recreate asteroids in Pyglet) to generate vector based objects which can crash into each other.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<p>First off as always, start by setting up a virtual environment with your preferred method (<a href="https://jmckew.com/2019/01/11/episode-8-anaconda/">Anaconda</a> or <a href="https://jmckew.com/2019/08/30/python-project-workflow/">follow my workflow</a>), since Pyglet has no external dependencies, all you need to do is install the pyglet package.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<p>I won't go through all the code in the example, and how it works, I will only go through what I changed in the case to get where I wanted to go.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<p>To begin, and make things a bit easier, I downloaded the pyglet-master repository from GitHub (<a href="https://github.com/pyglet/pyglet">https://github.com/pyglet/pyglet</a>) so I didn't have to create and copy the file contents one by one.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<p>After going through the different versions with the examples > game folder, I decided all I required was the simple functionality of collision and any further into developing the game wasn't needed for this stage, so I copied out the version 3 folder.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<p>If we run 'asteroid.py' from within the version 3 folder, we are met with this screen</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":481,"align":"center"} -->

<p>::: {.wp-block-image}
<img alt="" class="wp-image-481" src="https://i0.wp.com/jmckew.com/wp-content/uploads/2019/10/image.png?fit=640%2C505&amp;ssl=1">
:::</p>
<!-- /wp:image -->

<!-- wp:paragraph -->

<p>Now since all I am trying to do is generate multiple objects (which will be shown with the player symbol to indicate direction), I can comment out the lines which give the lives, score, title and interactive player.</p>
<!-- /wp:paragraph -->

<!-- wp:syntaxhighlighter/code {"language":"python","lineNumbers":false} -->

<div class="highlight"><pre><span></span><span class="err">#</span><span class="w"> </span><span class="k">Set</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="k">top</span><span class="w"> </span><span class="n">labels</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">score_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyglet</span><span class="p">.</span><span class="nc">text</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="nc">text</span><span class="o">=</span><span class="ss">&quot;Score: 0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">575</span><span class="p">,</span><span class="w"> </span><span class="n">batch</span><span class="o">=</span><span class="n">main_batch</span><span class="p">)</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">level_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyglet</span><span class="p">.</span><span class="nc">text</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="nc">text</span><span class="o">=</span><span class="ss">&quot;Version 3: Basic Collision&quot;</span><span class="p">,</span><span class="w"></span>
<span class="err">#</span><span class="w">                                 </span><span class="n">x</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">575</span><span class="p">,</span><span class="w"> </span><span class="n">anchor_x</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">batch</span><span class="o">=</span><span class="n">main_batch</span><span class="p">)</span><span class="w"></span>

<span class="err">#</span><span class="w"> </span><span class="k">Initialize</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">player</span><span class="w"> </span><span class="n">sprite</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">player_ship</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">player</span><span class="p">.</span><span class="n">Player</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="n">batch</span><span class="o">=</span><span class="n">main_batch</span><span class="p">)</span><span class="w"></span>

<span class="err">#</span><span class="w"> </span><span class="n">Make</span><span class="w"> </span><span class="n">three</span><span class="w"> </span><span class="n">sprites</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">represent</span><span class="w"> </span><span class="n">remaining</span><span class="w"> </span><span class="n">lives</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">player_lives</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">load</span><span class="p">.</span><span class="n">player_lives</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">main_batch</span><span class="p">)</span><span class="w"></span>

<span class="err">#</span><span class="w"> </span><span class="n">Make</span><span class="w"> </span><span class="n">three</span><span class="w"> </span><span class="n">asteroids</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">shoot</span><span class="w"> </span><span class="k">at</span><span class="w"> </span>
<span class="err">#</span><span class="w"> </span><span class="n">asteroids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">load</span><span class="p">.</span><span class="n">asteroids</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">player_ship</span><span class="p">.</span><span class="k">position</span><span class="p">,</span><span class="w"> </span><span class="n">main_batch</span><span class="p">)</span><span class="w"></span>

<span class="n">asteroids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">load</span><span class="p">.</span><span class="n">asteroids</span><span class="p">(</span><span class="mi">100</span><span class="p">,(</span><span class="n">window_width</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">window_height</span><span class="o">//</span><span class="mi">2</span><span class="p">),</span><span class="n">main_batch</span><span class="p">)</span><span class="w"></span>

<span class="err">#</span><span class="w"> </span><span class="n">Store</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">list</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">game_objects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">player_ship</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">asteroids</span><span class="w"></span>
<span class="n">game_objects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">asteroids</span><span class="w"></span>

<span class="err">#</span><span class="w"> </span><span class="n">Tell</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="k">window</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">player</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="n">responds</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">events</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">game_window</span><span class="p">.</span><span class="n">push_handlers</span><span class="p">(</span><span class="n">player_ship</span><span class="p">.</span><span class="n">key_handler</span><span class="p">)</span><span class="w"></span>
</pre></div>


<!-- /wp:syntaxhighlighter/code -->

<!-- wp:paragraph -->

<p>Now that we've done that, we need to modify the asteroids generator function to use the player sprite.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<p>In load.py, you can change simply the img argument to the player image sprite reference like so:</p>
<!-- /wp:paragraph -->

<!-- wp:syntaxhighlighter/code {"language":"python","lineNumbers":false} -->

<div class="highlight"><pre><span></span><span class="n">new_asteroid</span> <span class="o">=</span> <span class="n">physicalobject</span><span class="p">.</span><span class="n">PhysicalObject</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">resources</span><span class="p">.</span><span class="n">player_image</span><span class="p">,</span>                                                     <span class="n">x</span><span class="o">=</span><span class="n">asteroid_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">asteroid_y</span><span class="p">,</span>                                                 <span class="n">batch</span><span class="o">=</span><span class="n">batch</span><span class="p">)</span>
</pre></div>


<!-- /wp:syntaxhighlighter/code -->

<!-- wp:paragraph -->

<p>Now if we run this, the animation will look a little off, because the objects won't be traveling the direction in the direction that the sprite is pointing. This is due to the existing velocity calculation being a random number for both the X and Y component.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<p>To make the player sprites move in the direction they are rotated in, and maintain the existing codebase, we will need to convert from <a href="https://www.mathsisfun.com/polar-cartesian-coordinates.html">polar notation to cartesian</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<p>To do this, we add an extra 2 functions into 'util.py' which will do this for us:</p>
<!-- /wp:paragraph -->

<!-- wp:syntaxhighlighter/code {"language":"python","lineNumbers":false} -->

<div class="highlight"><pre><span></span><span class="nv">def</span> <span class="nv">cart2pol</span><span class="ss">(</span><span class="nv">x</span>, <span class="nv">y</span><span class="ss">)</span>:
    <span class="nv">rho</span> <span class="o">=</span> <span class="nv">math</span>.<span class="nv">sqrt</span><span class="ss">(</span><span class="nv">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="nv">y</span><span class="o">**</span><span class="mi">2</span><span class="ss">)</span>
    <span class="nv">phi</span> <span class="o">=</span> <span class="nv">math</span>.<span class="nv">arctan2</span><span class="ss">(</span><span class="nv">y</span>, <span class="nv">x</span><span class="ss">)</span>
    <span class="k">return</span><span class="ss">(</span><span class="nv">rho</span>, <span class="nv">phi</span><span class="ss">)</span>

<span class="nv">def</span> <span class="nv">pol2cart</span><span class="ss">(</span><span class="nv">rho</span>, <span class="nv">phi</span><span class="ss">)</span>:
    <span class="nv">x</span> <span class="o">=</span> <span class="nv">rho</span> <span class="o">*</span> <span class="nv">math</span>.<span class="nv">sin</span><span class="ss">(</span><span class="nv">math</span>.<span class="nv">radians</span><span class="ss">(</span><span class="nv">phi</span><span class="ss">))</span>
    <span class="nv">y</span> <span class="o">=</span> <span class="nv">rho</span> <span class="o">*</span> <span class="nv">math</span>.<span class="nv">cos</span><span class="ss">(</span><span class="nv">math</span>.<span class="nv">radians</span><span class="ss">(</span><span class="nv">phi</span><span class="ss">))</span>
    <span class="k">return</span><span class="ss">(</span><span class="nv">x</span>, <span class="nv">y</span><span class="ss">)</span>
</pre></div>


<!-- /wp:syntaxhighlighter/code -->

<!-- wp:paragraph -->

<p>Note the use of radians in pol2cart, this is due to the <a href="https://www.sparknotes.com/math/trigonometry/trigonometricfunctions/section3/">affect of quadrants and trigonometric functions</a>. I won't go into detail, but it won't behave like you expect it to.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<p>Now to get our player sprites moving in the direction they are rotated, update the code which generates the 'asteroids' to utilise our new function:</p>
<!-- /wp:paragraph -->

<!-- wp:syntaxhighlighter/code {"language":"python","lineNumbers":false} -->

<div class="highlight"><pre><span></span><span class="nv">new_asteroid</span>.<span class="nv">rotation</span> <span class="o">=</span> <span class="k">random</span>.<span class="nv">randint</span><span class="ss">(</span><span class="mi">0</span>, <span class="mi">360</span><span class="ss">)</span>
<span class="nv">new_asteroid</span>.<span class="nv">velocity_speed</span> <span class="o">=</span> <span class="k">random</span>.<span class="k">random</span><span class="ss">()</span> <span class="o">*</span> <span class="mi">40</span>
<span class="nv">new_asteroid</span>.<span class="nv">velocity_x</span>, <span class="nv">new_asteroid</span>.<span class="nv">velocity_y</span> <span class="o">=</span> <span class="nv">util</span>.<span class="nv">pol2cart</span><span class="ss">(</span><span class="nv">new_asteroid</span>.<span class="nv">velocity_speed</span>,<span class="nv">new_asteroid</span>.<span class="nv">rotation</span><span class="ss">)</span>
</pre></div>


<!-- /wp:syntaxhighlighter/code -->

<!-- wp:paragraph -->

<p>Now when we go and run our main file again, we will met with a screen like this:</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":482,"align":"center"} -->

<p>::: {.wp-block-image}
<img alt="" class="wp-image-482" src="https://i1.wp.com/jmckew.com/wp-content/uploads/2019/10/image-1.png?fit=640%2C505&amp;ssl=1">
:::</p>
<!-- /wp:image -->

<!-- wp:paragraph -->

<p>Where the player sprites will float around in the direction they are pointing, until they crash into another sprite, causing both of them to disappear.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<p>This is a quick intro to Pyglet, I am hoping to expand on this simulation and am positive I will be doing further write ups with it in the future.</p>
<!-- /wp:paragraph -->
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>