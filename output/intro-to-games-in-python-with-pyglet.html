
<!DOCTYPE html>
<html lang="english">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://nifty-engelbart-ce3324.netlify.com/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://nifty-engelbart-ce3324.netlify.com/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://nifty-engelbart-ce3324.netlify.com/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://nifty-engelbart-ce3324.netlify.com/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://nifty-engelbart-ce3324.netlify.com/theme/font-awesome/css/solid.css">

    <link href="https://nifty-engelbart-ce3324.netlify.com/static/custom.css" rel="stylesheet">



    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">



<meta name="author" content="admin" />
<meta name="description" content="Recently, I&#39;ve been researching ways that I could run a 2D simulation (and hopefully 3D) with many moving pieces and there was a desire to make it interactive as well. I stumbled through many visualisation frameworks such as: p5 pygame plotly panda3d bokeh many others Eventually, through the motivation of …" />
<meta name="keywords" content="">

<meta property="og:site_name" content="Jack McKew's Blog"/>
<meta property="og:title" content="Intro to Games in Python with Pyglet"/>
<meta property="og:description" content="Recently, I&#39;ve been researching ways that I could run a 2D simulation (and hopefully 3D) with many moving pieces and there was a desire to make it interactive as well. I stumbled through many visualisation frameworks such as: p5 pygame plotly panda3d bokeh many others Eventually, through the motivation of …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://nifty-engelbart-ce3324.netlify.com/intro-to-games-in-python-with-pyglet.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-10-04 06:30:00+10:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://nifty-engelbart-ce3324.netlify.com/author/admin.html">
<meta property="article:section" content="Code Fridays"/>
<meta property="og:image" content="img/jm-photo">

  <title>Jack McKew's Blog &ndash; Intro to Games in Python with Pyglet</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://nifty-engelbart-ce3324.netlify.com">
        <img src="img/jm-photo" alt="Jack McKew's Blog" title="Jack McKew's Blog">
      </a>
      <h1><a href="https://nifty-engelbart-ce3324.netlify.com">Jack McKew's Blog</a></h1>

<p>Python enthusiast, electrical engineer and tinkerer</p>
      <nav>
        <ul class="list">
          <li><a href="https://nifty-engelbart-ce3324.netlify.com/pages/contact.html#contact">Contact</a></li>
          <li><a href="https://nifty-engelbart-ce3324.netlify.com/pages/cv-professional.html#cv-professional">CV/Professional</a></li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-twitter" href="https://twitter.com/Jac_McQ" target="_blank">
            <i class="fab fa-twitter">
            </i>
          </a></li>
          <li>
            <a  class="sc-linkedin" href="https://www.linkedin.com/in/jack-mckew/" target="_blank">
            <i class="fab fa-linkedin">
            </i>
          </a></li>
          <li>
            <a  class="sc-github" href="https://github.com/JackMcKew" target="_blank">
            <i class="fab fa-github">
            </i>
          </a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://nifty-engelbart-ce3324.netlify.com">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>
      <a href="/sitemap.xml">Sitemap</a>


    </nav>

<article class="single">
  <header>
      
    <h1 id="intro-to-games-in-python-with-pyglet">Intro to Games in Python with Pyglet</h1>
    <p>
          Posted on Fri 04 October 2019 in <a href="https://nifty-engelbart-ce3324.netlify.com/category/code-fridays.html">Code Fridays</a>


    </p>
  </header>


  <div>
    <!-- wp:paragraph --><html><head></head><body><p>Recently, I've been researching ways that I could run a 2D simulation (and hopefully 3D) with many moving pieces and there was a desire to make it interactive as well. I stumbled through many visualisation frameworks such as:</p>
<!-- /wp:paragraph -->
<!-- wp:list -->
<ul>
<li><a href="https://pypi.org/project/p5/">p5</a></li>
<li><a href="https://www.pygame.org/news">pygame</a></li>
<li><a href="https://plot.ly/">plotly</a></li>
<li><a href="https://www.panda3d.org/">panda3d</a></li>
<li><a href="https://bokeh.pydata.org/en/latest/">bokeh</a></li>
<li>many others</li>
</ul>
<!-- /wp:list -->
<!-- wp:paragraph -->
<p>Eventually, through the motivation of another side project (looking into training neural networks to learn how to play games) and inspired by this video from Code Bullet <a href="https://www.youtube.com/watch?v=r428O_CMcpI">https://www.youtube.com/watch?v=r428O_CMcpI</a>; I decided on attempting to use <a href="https://pyglet.readthedocs.io/en/stable/">Pyglet</a> to do these simulations.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>While the aforementioned simulations won't be covered in this post, this post aims to demonstrate how I adapted the <a href="https://pyglet.readthedocs.io/en/stable/programming_guide/examplegame.html">in-depth tutorial on the Pyglet website</a> (which goes through how to recreate asteroids in Pyglet) to generate vector based objects which can crash into each other.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>First off as always, start by setting up a virtual environment with your preferred method (<a href="https://jmckew.com/2019/01/11/episode-8-anaconda/">Anaconda</a> or <a href="https://jmckew.com/2019/08/30/python-project-workflow/">follow my workflow</a>), since Pyglet has no external dependencies, all you need to do is install the pyglet package.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>I won't go through all the code in the example, and how it works, I will only go through what I changed in the case to get where I wanted to go.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>To begin, and make things a bit easier, I downloaded the pyglet-master repository from GitHub (<a href="https://github.com/pyglet/pyglet">https://github.com/pyglet/pyglet</a>) so I didn't have to create and copy the file contents one by one.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>After going through the different versions with the examples &gt; game folder, I decided all I required was the simple functionality of collision and any further into developing the game wasn't needed for this stage, so I copied out the version 3 folder.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>If we run 'asteroid.py' from within the version 3 folder, we are met with this screen</p>
<!-- /wp:paragraph -->
<!-- wp:image {"id":481,"align":"center"} -->
<p>::: {.wp-block-image}
<img alt="" class="wp-image-481" src="https://i0.wp.com/jmckew.com/wp-content/uploads/2019/10/image.png?fit=640%2C505&amp;ssl=1"/>
:::</p>
<!-- /wp:image -->
<!-- wp:paragraph -->
<p>Now since all I am trying to do is generate multiple objects (which will be shown with the player symbol to indicate direction), I can comment out the lines which give the lives, score, title and interactive player.</p>
<!-- /wp:paragraph -->
<!-- wp:syntaxhighlighter/code {"language":"python","lineNumbers":false} -->
<div class="highlight"><pre><span class="code-line"><span></span><span class="err">#</span><span class="w"> </span><span class="k">Set</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="k">top</span><span class="w"> </span><span class="n">labels</span><span class="w"></span></span>
<span class="code-line"><span class="err">#</span><span class="w"> </span><span class="n">score_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyglet</span><span class="p">.</span><span class="nc">text</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="nc">text</span><span class="o">=</span><span class="ss">"Score: 0"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">575</span><span class="p">,</span><span class="w"> </span><span class="n">batch</span><span class="o">=</span><span class="n">main_batch</span><span class="p">)</span><span class="w"></span></span>
<span class="code-line"><span class="err">#</span><span class="w"> </span><span class="n">level_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyglet</span><span class="p">.</span><span class="nc">text</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="nc">text</span><span class="o">=</span><span class="ss">"Version 3: Basic Collision"</span><span class="p">,</span><span class="w"></span></span>
<span class="code-line"><span class="err">#</span><span class="w">                                 </span><span class="n">x</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">575</span><span class="p">,</span><span class="w"> </span><span class="n">anchor_x</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span><span class="w"> </span><span class="n">batch</span><span class="o">=</span><span class="n">main_batch</span><span class="p">)</span><span class="w"></span></span>
<span class="code-line"></span>
<span class="code-line"><span class="err">#</span><span class="w"> </span><span class="k">Initialize</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">player</span><span class="w"> </span><span class="n">sprite</span><span class="w"></span></span>
<span class="code-line"><span class="err">#</span><span class="w"> </span><span class="n">player_ship</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">player</span><span class="p">.</span><span class="n">Player</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="n">batch</span><span class="o">=</span><span class="n">main_batch</span><span class="p">)</span><span class="w"></span></span>
<span class="code-line"></span>
<span class="code-line"><span class="err">#</span><span class="w"> </span><span class="n">Make</span><span class="w"> </span><span class="n">three</span><span class="w"> </span><span class="n">sprites</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">represent</span><span class="w"> </span><span class="n">remaining</span><span class="w"> </span><span class="n">lives</span><span class="w"></span></span>
<span class="code-line"><span class="err">#</span><span class="w"> </span><span class="n">player_lives</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">load</span><span class="p">.</span><span class="n">player_lives</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">main_batch</span><span class="p">)</span><span class="w"></span></span>
<span class="code-line"></span>
<span class="code-line"><span class="err">#</span><span class="w"> </span><span class="n">Make</span><span class="w"> </span><span class="n">three</span><span class="w"> </span><span class="n">asteroids</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">shoot</span><span class="w"> </span><span class="k">at</span><span class="w"> </span></span>
<span class="code-line"><span class="err">#</span><span class="w"> </span><span class="n">asteroids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">load</span><span class="p">.</span><span class="n">asteroids</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">player_ship</span><span class="p">.</span><span class="k">position</span><span class="p">,</span><span class="w"> </span><span class="n">main_batch</span><span class="p">)</span><span class="w"></span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">asteroids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">load</span><span class="p">.</span><span class="n">asteroids</span><span class="p">(</span><span class="mi">100</span><span class="p">,(</span><span class="n">window_width</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">window_height</span><span class="o">//</span><span class="mi">2</span><span class="p">),</span><span class="n">main_batch</span><span class="p">)</span><span class="w"></span></span>
<span class="code-line"></span>
<span class="code-line"><span class="err">#</span><span class="w"> </span><span class="n">Store</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">list</span><span class="w"></span></span>
<span class="code-line"><span class="err">#</span><span class="w"> </span><span class="n">game_objects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">player_ship</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">asteroids</span><span class="w"></span></span>
<span class="code-line"><span class="n">game_objects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">asteroids</span><span class="w"></span></span>
<span class="code-line"></span>
<span class="code-line"><span class="err">#</span><span class="w"> </span><span class="n">Tell</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="k">window</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">player</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="n">responds</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">events</span><span class="w"></span></span>
<span class="code-line"><span class="err">#</span><span class="w"> </span><span class="n">game_window</span><span class="p">.</span><span class="n">push_handlers</span><span class="p">(</span><span class="n">player_ship</span><span class="p">.</span><span class="n">key_handler</span><span class="p">)</span><span class="w"></span></span>
</pre></div>
<!-- /wp:syntaxhighlighter/code -->
<!-- wp:paragraph -->
<p>Now that we've done that, we need to modify the asteroids generator function to use the player sprite.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>In load.py, you can change simply the img argument to the player image sprite reference like so:</p>
<!-- /wp:paragraph -->
<!-- wp:syntaxhighlighter/code {"language":"python","lineNumbers":false} -->
<div class="highlight"><pre><span class="code-line"><span></span><span class="n">new_asteroid</span> <span class="o">=</span> <span class="n">physicalobject</span><span class="p">.</span><span class="n">PhysicalObject</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">resources</span><span class="p">.</span><span class="n">player_image</span><span class="p">,</span>                                                     <span class="n">x</span><span class="o">=</span><span class="n">asteroid_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">asteroid_y</span><span class="p">,</span>                                                 <span class="n">batch</span><span class="o">=</span><span class="n">batch</span><span class="p">)</span></span>
</pre></div>
<!-- /wp:syntaxhighlighter/code -->
<!-- wp:paragraph -->
<p>Now if we run this, the animation will look a little off, because the objects won't be traveling the direction in the direction that the sprite is pointing. This is due to the existing velocity calculation being a random number for both the X and Y component.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>To make the player sprites move in the direction they are rotated in, and maintain the existing codebase, we will need to convert from <a href="https://www.mathsisfun.com/polar-cartesian-coordinates.html">polar notation to cartesian</a>.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>To do this, we add an extra 2 functions into 'util.py' which will do this for us:</p>
<!-- /wp:paragraph -->
<!-- wp:syntaxhighlighter/code {"language":"python","lineNumbers":false} -->
<div class="highlight"><pre><span class="code-line"><span></span><span class="nv">def</span> <span class="nv">cart2pol</span><span class="ss">(</span><span class="nv">x</span>, <span class="nv">y</span><span class="ss">)</span>:</span>
<span class="code-line">    <span class="nv">rho</span> <span class="o">=</span> <span class="nv">math</span>.<span class="nv">sqrt</span><span class="ss">(</span><span class="nv">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="nv">y</span><span class="o">**</span><span class="mi">2</span><span class="ss">)</span></span>
<span class="code-line">    <span class="nv">phi</span> <span class="o">=</span> <span class="nv">math</span>.<span class="nv">arctan2</span><span class="ss">(</span><span class="nv">y</span>, <span class="nv">x</span><span class="ss">)</span></span>
<span class="code-line">    <span class="k">return</span><span class="ss">(</span><span class="nv">rho</span>, <span class="nv">phi</span><span class="ss">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nv">def</span> <span class="nv">pol2cart</span><span class="ss">(</span><span class="nv">rho</span>, <span class="nv">phi</span><span class="ss">)</span>:</span>
<span class="code-line">    <span class="nv">x</span> <span class="o">=</span> <span class="nv">rho</span> <span class="o">*</span> <span class="nv">math</span>.<span class="nv">sin</span><span class="ss">(</span><span class="nv">math</span>.<span class="nv">radians</span><span class="ss">(</span><span class="nv">phi</span><span class="ss">))</span></span>
<span class="code-line">    <span class="nv">y</span> <span class="o">=</span> <span class="nv">rho</span> <span class="o">*</span> <span class="nv">math</span>.<span class="nv">cos</span><span class="ss">(</span><span class="nv">math</span>.<span class="nv">radians</span><span class="ss">(</span><span class="nv">phi</span><span class="ss">))</span></span>
<span class="code-line">    <span class="k">return</span><span class="ss">(</span><span class="nv">x</span>, <span class="nv">y</span><span class="ss">)</span></span>
</pre></div>
<!-- /wp:syntaxhighlighter/code -->
<!-- wp:paragraph -->
<p>Note the use of radians in pol2cart, this is due to the <a href="https://www.sparknotes.com/math/trigonometry/trigonometricfunctions/section3/">affect of quadrants and trigonometric functions</a>. I won't go into detail, but it won't behave like you expect it to.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>Now to get our player sprites moving in the direction they are rotated, update the code which generates the 'asteroids' to utilise our new function:</p>
<!-- /wp:paragraph -->
<!-- wp:syntaxhighlighter/code {"language":"python","lineNumbers":false} -->
<div class="highlight"><pre><span class="code-line"><span></span><span class="nv">new_asteroid</span>.<span class="nv">rotation</span> <span class="o">=</span> <span class="k">random</span>.<span class="nv">randint</span><span class="ss">(</span><span class="mi">0</span>, <span class="mi">360</span><span class="ss">)</span></span>
<span class="code-line"><span class="nv">new_asteroid</span>.<span class="nv">velocity_speed</span> <span class="o">=</span> <span class="k">random</span>.<span class="k">random</span><span class="ss">()</span> <span class="o">*</span> <span class="mi">40</span></span>
<span class="code-line"><span class="nv">new_asteroid</span>.<span class="nv">velocity_x</span>, <span class="nv">new_asteroid</span>.<span class="nv">velocity_y</span> <span class="o">=</span> <span class="nv">util</span>.<span class="nv">pol2cart</span><span class="ss">(</span><span class="nv">new_asteroid</span>.<span class="nv">velocity_speed</span>,<span class="nv">new_asteroid</span>.<span class="nv">rotation</span><span class="ss">)</span></span>
</pre></div>
<!-- /wp:syntaxhighlighter/code -->
<!-- wp:paragraph -->
<p>Now when we go and run our main file again, we will met with a screen like this:</p>
<!-- /wp:paragraph -->
<!-- wp:image {"id":482,"align":"center"} -->
<p>::: {.wp-block-image}
<img alt="" class="wp-image-482" src="https://i1.wp.com/jmckew.com/wp-content/uploads/2019/10/image-1.png?fit=640%2C505&amp;ssl=1"/>
:::</p>
<!-- /wp:image -->
<!-- wp:paragraph -->
<p>Where the player sprites will float around in the direction they are pointing, until they crash into another sprite, causing both of them to disappear.</p>
<!-- /wp:paragraph -->
<!-- wp:paragraph -->
<p>This is a quick intro to Pyglet, I am hoping to expand on this simulation and am positive I will be doing further write ups with it in the future.</p>
<!-- /wp:paragraph --></body></html>
  </div>
  <div class="tag-cloud">
    <p>
    </p>
  </div>





</article>

    <footer>
<p>&copy;  </p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Jack McKew's Blog ",
  "url" : "https://nifty-engelbart-ce3324.netlify.com",
  "image": "img/jm-photo",
  "description": ""
}
</script>

</body>
</html>