
<!DOCTYPE html>
<html lang="english">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://nifty-engelbart-ce3324.netlify.com/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://nifty-engelbart-ce3324.netlify.com/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://nifty-engelbart-ce3324.netlify.com/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://nifty-engelbart-ce3324.netlify.com/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://nifty-engelbart-ce3324.netlify.com/theme/font-awesome/css/solid.css">




    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">



<meta name="author" content="Jack McKew" />
<meta name="description" content="Following on from last weeks post where we analysed the amount of repeated letters within current New Zealand town names. There was still one part of that analysis that really bugged me, and if you noticed it was from the data set that was used was using the European town …" />
<meta name="keywords" content="python">


<meta property="og:site_name" content="Jack McKew's Blog"/>
<meta property="og:title" content="Intro to Web Scraping"/>
<meta property="og:description" content="Following on from last weeks post where we analysed the amount of repeated letters within current New Zealand town names. There was still one part of that analysis that really bugged me, and if you noticed it was from the data set that was used was using the European town …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://nifty-engelbart-ce3324.netlify.com/posts/intro-to-web-scraping.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-08-23 06:30:00+10:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://nifty-engelbart-ce3324.netlify.com/author/jack-mckew.html">
<meta property="article:section" content="misc"/>
<meta property="article:tag" content="python"/>
<meta property="og:image" content="/jm-photo.jpg">

  <title>Jack McKew's Blog &ndash; Intro to Web Scraping</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://nifty-engelbart-ce3324.netlify.com">
        <img src="/jm-photo.jpg" alt="" title="">
      </a>
      <h1><a href="https://nifty-engelbart-ce3324.netlify.com"></a></h1>

<p>Python enthusiast, electrical engineer and tinkerer</p>
      <nav>
        <ul class="list">

            <li><a target="_blank" href="https://nifty-engelbart-ce3324.netlify.com/pages/contact.html#contact">Contact</a></li>
            <li><a target="_blank" href="https://nifty-engelbart-ce3324.netlify.com/pages/cv-professional.html#cv-professional">CV/Professional</a></li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-twitter" href="https://twitter.com/Jac_McQ" target="_blank">
            <i class="fab fa-twitter">
            </i>
          </a></li>
          <li>
            <a  class="sc-linkedin" href="https://www.linkedin.com/in/jack-mckew/" target="_blank">
            <i class="fab fa-linkedin">
            </i>
          </a></li>
          <li>
            <a  class="sc-github" href="https://github.com/JackMcKew" target="_blank">
            <i class="fab fa-github">
            </i>
          </a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://nifty-engelbart-ce3324.netlify.com">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/tags.html">Tags</a>
      <a href="/sitemap.xml">Sitemap</a>


    </nav>

<article class="single">
  <header>
      
    <h1 id="intro-to-web-scraping">Intro to Web Scraping</h1>
    <p>
          Posted on Fri 23 August 2019 in <a href="https://nifty-engelbart-ce3324.netlify.com/category/misc.html">misc</a>


        &#8226; 3 min read
    </p>
  </header>


  <div>
    <body><p>Following on from last weeks post where we analysed the amount of <a href="https://jmckew.com/2019/08/16/looking-for-patterns-in-city-names-interactive-plotting/">repeated letters within current New Zealand town names</a>. There was still one part of that analysis that really bugged me, and if you noticed it was from the data set that was used was using the European town names not the original Maori names. This post will be dedicated to introducing web scraping where we will extract the Maori names and run a similar analysis to present an interactive graph.</p>
<p>As like previously, let's take a look at the interactive graph before getting into how it was created.</p>
<iframe frameborder="0" height="500" sandbox="allow-same-origin allow-scripts" scrolling="no" seamless="seamless" src="..\html\intro-to-web-scraping\letter_count.html" width="100%">
</iframe>
<p>Similarly with most of my posts of this nature, we always begin by getting the data. To find a data set that gives us as many Maori town or place names as possible proved to be quite challenging, but luckily for Maori Language week NZhistory.gov.nz posted a table of a 1000 Maori place names, their components and the meaning. This data can be found: <a href="https://nzhistory.govt.nz/culture/maori-language-week/1000-maori-place-names">https://nzhistory.govt.nz/culture/maori-language-week/1000-maori-place-names</a>.</p>
<p>Unlike last time however with our world city names from <a href="https://www.kaggle.com/">Kaggle</a>, this data isn't nicely supplied to us in an Excel format. While it may be possible to directly copy-paste from the website into a spreadsheet, I think this is a great way to ease into web scraping.</p>
<h2>What is Web Scraping?</h2>
<p>Web scraping, web harvesting or web data extraction is the process of extracting data from websites. To do this in Python, while there is multiple ways to achieve this (requests + beautiful soup, selenium, etc), my personal favourite package to use is <a href="https://scrapy.org/">Scrapy</a>. While it may be daunting to begin with from a non object-oriented basis, you will soon appreciate it more once you've begun using it.</p>
<p>Initially the premise around the <a href="https://scrapy.org/">Scrapy</a> package is to create 'web spiders'. If we take a look of the structure of the first example on the <a href="https://scrapy.org/">Scrapy</a> website we get an understanding on how to structure our web spiders when developing:</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="kn">import</span> <span class="nn">scrapy</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">class</span> <span class="nc">BlogSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span></span>
<span class="code-line">    <span class="n">name</span> <span class="o">=</span> <span class="s1">'blogspider'</span></span>
<span class="code-line">    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'https://blog.scrapinghub.com'</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span></span>
<span class="code-line">        <span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">'.post-header&gt;h2'</span><span class="p">):</span></span>
<span class="code-line">            <span class="k">yield</span> <span class="p">{</span><span class="s1">'title'</span><span class="p">:</span> <span class="n">title</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">'a ::text'</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()}</span></span>
<span class="code-line">        <span class="k">for</span> <span class="n">next_page</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">'a.next-posts-link'</span><span class="p">):</span></span>
<span class="code-line">            <span class="k">yield</span> <span class="n">response</span><span class="o">.</span><span class="n">follow</span><span class="p">(</span><span class="n">next_page</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">)</span></span>
</pre></div>
<p>First of all we can see that the custom spider is essentially an extension of the scrapy.Spider class. It is to be noted that the name and start_urls variables (which are apart of the class) are special in the sense the scrapy package uses them as configuration settings. When it comes to web scraping, if you have had experience using HTML, CSS and/or Javascript, this experience will become extremely useful; that is not to say it is not possible without experience, it's just a learning curve.</p>
<p>Following on we can see a function for parsing (also specially named) in which there are 2 loops, the first for loop is going to loop through all title's marked as headers (specifically h2) and return a dictionary with the text in the heading.</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="k">class</span> <span class="nc">NameSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Spider</span><span class="p">):</span></span>
<span class="code-line">    <span class="n">name</span> <span class="o">=</span> <span class="s1">'names'</span></span>
<span class="code-line">    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'https://nzhistory.govt.nz/culture/maori-language-week/1000-maori-place-names/'</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">response</span><span class="p">):</span></span>
<span class="code-line">        <span class="k">def</span> <span class="nf">extract_from_table</span><span class="p">(</span><span class="n">table_row</span><span class="p">,</span><span class="n">table_col</span><span class="p">):</span></span>
<span class="code-line">            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">f</span><span class="s2">"//tr[{table_row}]//td[{table_col}]//text()"</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1000</span><span class="p">):</span></span>
<span class="code-line">            <span class="k">yield</span> <span class="p">{</span></span>
<span class="code-line">                <span class="s1">'Place Name'</span> <span class="p">:</span> <span class="n">extract_from_table</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span></span>
<span class="code-line">                <span class="s1">'Components'</span> <span class="p">:</span> <span class="n">extract_from_table</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span></span>
<span class="code-line">                <span class="s1">'Meaning'</span> <span class="p">:</span> <span class="n">extract_from_table</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span></span>
<span class="code-line">            <span class="p">}</span></span>
</pre></div>
<p>Now that we have created our spider that looks through each row of the table on the webpage (more information on determining this can be found: <a href="https://docs.scrapy.org/en/latest/intro/tutorial.html">https://docs.scrapy.org/en/latest/intro/tutorial.html</a>). It's time to run the spider and take a look at the output. To run a spider you go into the directory from the command line and run 'scrapy crawl \&lt;spider name&gt;' and to store an output at the same time 'scrapy crawl \&lt;spider name&gt; -o filename.csv -t csv.</p>
<p>Now similar to the previous post, we run a similar analysis and plot with Bokeh!</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">collections</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">operator</span></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">math</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">show</span><span class="p">,</span> <span class="n">output_file</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">ColumnDataSource</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">bokeh.models.tools</span> <span class="kn">import</span> <span class="n">HoverTool</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">names_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'names.csv'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">','</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s1">'"'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">nz_names</span> <span class="o">=</span> <span class="n">names_df</span><span class="p">[</span><span class="s1">'Place Name'</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></span>
<span class="code-line"><span class="n">nz_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nz_names</span> <span class="p">}</span></span>
<span class="code-line"><span class="n">letters</span> <span class="o">=</span> <span class="s1">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span></span>
<span class="code-line"><span class="n">lcount</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">([(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">letters</span><span class="p">]))</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">nz_names</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">nz_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">([(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">letters</span><span class="p">]))</span></span>
<span class="code-line">    <span class="n">city_dict</span> <span class="o">=</span> <span class="n">nz_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></span>
<span class="code-line">    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span></span>
<span class="code-line">        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">letters</span><span class="p">:</span></span>
<span class="code-line">            <span class="n">city_dict</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">+=</span> <span class="mi">1</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">total_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">nz_dict</span><span class="p">)</span></span>
<span class="code-line"><span class="n">total_df</span> <span class="o">=</span> <span class="n">total_df</span><span class="o">.</span><span class="n">T</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">max_letters_cities</span> <span class="o">=</span> <span class="n">total_df</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></span>
<span class="code-line"><span class="n">lettercounts</span> <span class="o">=</span> <span class="n">total_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">total_df</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></span>
<span class="code-line"><span class="n">maxletters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">([(</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">letters</span><span class="p">]))</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">letters</span><span class="p">):</span></span>
<span class="code-line">    <span class="n">maxletters</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_letters_cities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></span>
<span class="code-line">    <span class="n">maxletters</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lettercounts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span></span>
<span class="code-line"><span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span></span>
<span class="code-line"><span class="n">summary_df</span><span class="p">[</span><span class="s1">'Word_Name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_df</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span></span>
<span class="code-line"><span class="n">summary_df</span><span class="p">[</span><span class="s1">'Count'</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">total_df</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">summary_df</span><span class="p">)</span></span>
<span class="code-line"><span class="n">output_file</span><span class="p">(</span><span class="s2">"letter_count.html"</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">()</span></span>
<span class="code-line"><span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[</span></span>
<span class="code-line">    <span class="p">(</span><span class="s1">'Word'</span><span class="p">,</span> <span class="s1">'@Word'</span><span class="p">)</span></span>
<span class="code-line"><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">summary_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">plot_height</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Letter Counts"</span><span class="p">,</span></span>
<span class="code-line">           <span class="n">toolbar_location</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">p</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">'index'</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">'Count'</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span></span>
<span class="code-line"><span class="n">p</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">hover</span><span class="p">)</span></span>
<span class="code-line"><span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="bp">None</span></span>
<span class="code-line"><span class="n">p</span><span class="o">.</span><span class="n">y_range</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="mi">0</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></span>
</pre></div></body>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://nifty-engelbart-ce3324.netlify.com/tag/python.html">python</a>
    </p>
  </div>





</article>

    <footer>
<p>&copy;  </p>
<p>    Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Jack McKew's Blog ",
  "url" : "https://nifty-engelbart-ce3324.netlify.com",
  "image": "/jm-photo.jpg",
  "description": ""
}
</script>

</body>
</html>